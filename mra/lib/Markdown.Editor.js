(function(){function c(){}function h(e){this.buttonBar=r.getElementById("wmd-button-bar"+e);this.preview=r.getElementById("wmd-preview"+e);this.input=r.getElementById("wmd-input"+e)}function p(t,n){var r=this;var i=[];var s=0;var o="none";var a;var f;var l;var c=function(e,t){if(o!=e){o=e;if(!t){p()}}if(!u.isIE||o!="moving"){f=setTimeout(h,1)}else{l=null}};var h=function(e){l=new d(n,e);f=undefined};this.setCommandMode=function(){o="command";p();f=setTimeout(h,0)};this.canUndo=function(){return s>1};this.canRedo=function(){if(i[s+1]){return true}return false};this.undo=function(){if(r.canUndo()){if(a){a.restore();a=null}else{i[s]=new d(n);i[--s].restore();if(t){t()}}}o="none";n.input.focus();h()};this.redo=function(){if(r.canRedo()){i[++s].restore();if(t){t()}}o="none";n.input.focus();h()};var p=function(){var e=l||new d(n);if(!e){return false}if(o=="moving"){if(!a){a=e}return}if(a){if(i[s-1].text!=a.text){i[s++]=a}a=null}i[s++]=e;i[s+1]=null;if(t){t()}};var v=function(e){var t=false;if((e.ctrlKey||e.metaKey)&&!e.altKey){var n=e.charCode||e.keyCode;var i=String.fromCharCode(n);switch(i.toLowerCase()){case"y":r.redo();t=true;break;case"z":if(!e.shiftKey){r.undo()}else{r.redo()}t=true;break}}if(t){if(e.preventDefault){e.preventDefault()}if(window.event){window.event.returnValue=false}return}};var m=function(e){if(!e.ctrlKey&&!e.metaKey){var t=e.keyCode;if(t>=33&&t<=40||t>=63232&&t<=63235){c("moving")}else if(t==8||t==46||t==127){c("deleting")}else if(t==13){c("newlines")}else if(t==27){c("escape")}else if((t<16||t>20)&&t!=91){c("typing")}}};var g=function(){e.addEvent(n.input,"keypress",function(e){if((e.ctrlKey||e.metaKey)&&!e.altKey&&(e.keyCode==89||e.keyCode==90)){e.preventDefault()}});var t=function(){if(u.isIE||l&&l.text!=n.input.value){if(f==undefined){o="paste";p();h()}}};e.addEvent(n.input,"keydown",v);e.addEvent(n.input,"keydown",m);e.addEvent(n.input,"mousedown",function(){c("moving")});n.input.onpaste=t;n.input.ondrop=t};var y=function(){g();h(true);p()};y()}function d(t,n){var i=this;var s=t.input;this.init=function(){if(!e.isVisible(s)){return}if(!n&&r.activeElement&&r.activeElement!==s){return}this.setInputAreaSelectionStartEnd();this.scrollTop=s.scrollTop;if(!this.text&&s.selectionStart||s.selectionStart===0){this.text=s.value}};this.setInputAreaSelection=function(){if(!e.isVisible(s)){return}if(s.selectionStart!==undefined&&!u.isOpera){s.focus();s.selectionStart=i.start;s.selectionEnd=i.end;s.scrollTop=i.scrollTop}else if(r.selection){if(r.activeElement&&r.activeElement!==s){return}s.focus();var t=s.createTextRange();t.moveStart("character",-s.value.length);t.moveEnd("character",-s.value.length);t.moveEnd("character",i.end);t.moveStart("character",i.start);t.select()}};this.setInputAreaSelectionStartEnd=function(){if(!t.ieCachedRange&&(s.selectionStart||s.selectionStart===0)){i.start=s.selectionStart;i.end=s.selectionEnd}else if(r.selection){i.text=e.fixEolChars(s.value);var n=t.ieCachedRange||r.selection.createRange();var o=e.fixEolChars(n.text);var u="";var a=u+o+u;n.text=a;var f=e.fixEolChars(s.value);n.moveStart("character",-a.length);n.text=o;i.start=f.indexOf(u);i.end=f.lastIndexOf(u)-u.length;var l=i.text.length-e.fixEolChars(s.value).length;if(l){n.moveStart("character",-o.length);while(l--){o+="\n";i.end+=1}n.text=o}if(t.ieCachedRange)i.scrollTop=t.ieCachedScrollTop;t.ieCachedRange=null;this.setInputAreaSelection()}};this.restore=function(){if(i.text!=undefined&&i.text!=s.value){s.value=i.text}this.setInputAreaSelection();s.scrollTop=i.scrollTop};this.getChunks=function(){var t=new c;t.before=e.fixEolChars(i.text.substring(0,i.start));t.startTag="";t.selection=e.fixEolChars(i.text.substring(i.start,i.end));t.endTag="";t.after=e.fixEolChars(i.text.substring(i.end));t.scrollTop=i.scrollTop;return t};this.setChunks=function(e){e.before=e.before+e.startTag;e.after=e.endTag+e.after;this.start=e.before.length;this.end=e.before.length+e.selection.length;this.text=e.before+e.selection+e.after;this.scrollTop=e.scrollTop};this.init()}function v(n,i,s){var o=this;var a;var f;var l;var c=3e3;var h="delayed";var p=function(t,n){e.addEvent(t,"input",n);t.onpaste=n;t.ondrop=n;e.addEvent(t,"keypress",n);e.addEvent(t,"keydown",n)};var d=function(){var e=0;if(window.innerHeight){e=window.pageYOffset}else if(r.documentElement&&r.documentElement.scrollTop){e=r.documentElement.scrollTop}else if(r.body){e=r.body.scrollTop}return e};var v=function(){if(!i.preview)return;var e=i.input.value;if(e&&e==l){return}else{l=e}var t=(new Date).getTime();e=n.makeHtml(e);var r=(new Date).getTime();f=r-t;T(e)};var m=function(){if(a){clearTimeout(a);a=undefined}if(h!=="manual"){var e=0;if(h==="delayed"){e=f}if(e>c){e=c}a=setTimeout(v,e)}};var g=function(e){if(e.scrollHeight<=e.clientHeight){return 1}return e.scrollTop/(e.scrollHeight-e.clientHeight)};var y=function(){if(i.preview){i.preview.scrollTop=(i.preview.scrollHeight-i.preview.clientHeight)*g(i.preview)}};this.refresh=function(e){if(e){l="";v()}else{m()}};this.processingTime=function(){return f};var b=true;var w=function(e){var t=i.preview;var n=t.parentNode;var r=t.nextSibling;n.removeChild(t);t.innerHTML=e;if(!r)n.appendChild(t);else n.insertBefore(t,r)};var E=function(e){i.preview.innerHTML=e};var S;var x=function(e){if(S)return S(e);try{E(e);S=E}catch(t){S=w;S(e)}};var T=function(e){var n=t.getTop(i.input)-d();if(i.preview){x(e);s()}y();if(b){b=false;return}var r=t.getTop(i.input)-d();if(u.isIE){setTimeout(function(){window.scrollBy(0,r-n)},0)}else{window.scrollBy(0,r-n)}};var N=function(){p(i.input,m);v();if(i.preview){i.preview.scrollTop=0}};N()}function m(t,n,i,o,a,f,l){function v(e){c.focus();if(e.textOp){if(i){i.setCommandMode()}var t=new d(n);if(!t){return}var r=t.getChunks();var s=function(){c.focus();if(r){t.setChunks(r)}t.restore();o.refresh()};var u=e.textOp(r,s);if(!u){s()}}if(e.execute){e.execute(i)}}function m(e,t){var i="0px";var s="-20px";var o="-40px";var a=e.getElementsByTagName("span")[0];if(t){a.style.backgroundPosition=e.XShift+" "+i;e.onmouseover=function(){a.style.backgroundPosition=this.XShift+" "+o};e.onmouseout=function(){a.style.backgroundPosition=this.XShift+" "+i};if(u.isIE){e.onmousedown=function(){if(r.activeElement&&r.activeElement!==n.input){return}n.ieCachedRange=document.selection.createRange();n.ieCachedScrollTop=n.input.scrollTop}}if(!e.isHelp){e.onclick=function(){if(this.onmouseout){this.onmouseout()}v(this);return false}}}else{a.style.backgroundPosition=e.XShift+" "+s;e.onmouseover=e.onmouseout=e.onclick=function(){}}}function g(e){if(typeof e==="string")e=a[e];return function(){e.apply(a,arguments)}}function y(){var e=n.buttonBar;var r="0px";var i="-20px";var o="-40px";var u=document.createElement("ul");u.id="wmd-button-row"+t;u.className="wmd-button-row";u=e.appendChild(u);var a=0;var c=function(e,n,r,i){var s=document.createElement("li");s.className="wmd-button";s.style.left=a+"px";a+=25;var o=document.createElement("span");s.id=e+t;s.appendChild(o);s.title=n;s.XShift=r;if(i)s.textOp=i;m(s,true);u.appendChild(s);return s};var p=function(e){var n=document.createElement("li");n.className="wmd-spacer wmd-spacer"+e;n.id="wmd-spacer"+e+t;u.appendChild(n);a+=25};h.bold=c("wmd-bold-button",l("bold"),"0px",g("doBold"));h.italic=c("wmd-italic-button",l("italic"),"-20px",g("doItalic"));p(1);h.link=c("wmd-link-button",l("link"),"-40px",g(function(e,t){return this.doLinkOrImage(e,t,false)}));h.quote=c("wmd-quote-button",l("quote"),"-60px",g("doBlockquote"));h.code=c("wmd-code-button",l("code"),"-80px",g("doCode"));h.image=c("wmd-image-button",l("image"),"-100px",g(function(e,t){return this.doLinkOrImage(e,t,true)}));p(2);h.olist=c("wmd-olist-button",l("olist"),"-120px",g(function(e,t){this.doList(e,t,true)}));h.ulist=c("wmd-ulist-button",l("ulist"),"-140px",g(function(e,t){this.doList(e,t,false)}));h.heading=c("wmd-heading-button",l("heading"),"-160px",g("doHeading"));h.hr=c("wmd-hr-button",l("hr"),"-180px",g("doHorizontalRule"));p(3);h.undo=c("wmd-undo-button",l("undo"),"-200px",null);h.undo.execute=function(e){if(e)e.undo()};var d=/win/.test(s.platform.toLowerCase())?l("redo"):l("redomac");h.redo=c("wmd-redo-button",d,"-220px",null);h.redo.execute=function(e){if(e)e.redo()};if(f){var v=document.createElement("li");var y=document.createElement("span");v.appendChild(y);v.className="wmd-button wmd-help-button";v.id="wmd-help-button"+t;v.XShift="-240px";v.isHelp=true;v.style.right="0px";v.title=l("help");v.onclick=f.handler;m(v,true);u.appendChild(v);h.help=v}b()}function b(){if(i){m(h.undo,i.canUndo());m(h.redo,i.canRedo())}}var c=n.input,h={};y();var p="keydown";if(u.isOpera){p="keypress"}e.addEvent(c,p,function(e){if((e.ctrlKey||e.metaKey)&&!e.altKey&&!e.shiftKey){var t=e.charCode||e.keyCode;var n=String.fromCharCode(t).toLowerCase();switch(n){case"b":v(h.bold);break;case"i":v(h.italic);break;case"l":v(h.link);break;case"q":v(h.quote);break;case"k":v(h.code);break;case"g":v(h.image);break;case"o":v(h.olist);break;case"u":v(h.ulist);break;case"h":v(h.heading);break;case"r":v(h.hr);break;case"y":v(h.redo);break;case"z":if(e.shiftKey){v(h.redo)}else{v(h.undo)}break;default:return}if(e.preventDefault){e.preventDefault()}if(window.event){window.event.returnValue=false}}});e.addEvent(c,"keyup",function(e){if(e.shiftKey&&!e.ctrlKey&&!e.metaKey){var t=e.charCode||e.keyCode;if(t===13){var n={};n.textOp=g("doAutoindent");v(n)}}});if(u.isIE){e.addEvent(c,"keydown",function(e){var t=e.keyCode;if(t===27){return false}})}this.setUndoRedoButtonStates=b}function g(e,t){this.hooks=e;this.getString=t}function b(e){return e.replace(/^\s*(.*?)(?:\s+"(.+)")?\s*$/,function(e,t,n){t=t.replace(/\?.*$/,function(e){return e.replace(/\+/g," ")});t=decodeURIComponent(t);t=encodeURI(t).replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29");t=t.replace(/\?.*$/,function(e){return e.replace(/\+/g,"%2b")});if(n){n=n.trim?n.trim():n.replace(/^\s*/,"").replace(/\s*$/,"");n=n.replace(/"/g,"quot;").replace(/\(/g,"&#40;").replace(/\)/g,"&#41;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}return n?t+' "'+n+'"':t})}var e={},t={},n={},r=window.document,i=window.RegExp,s=window.navigator,o={lineLength:72},u={isIE:/msie/.test(s.userAgent.toLowerCase()),isIE_5or6:/msie 6/.test(s.userAgent.toLowerCase())||/msie 5/.test(s.userAgent.toLowerCase()),isOpera:/opera/.test(s.userAgent.toLowerCase())};var a={bold:"Strong <strong> Ctrl+B",boldexample:"strong text",italic:"Emphasis <em> Ctrl+I",italicexample:"emphasized text",link:"Hyperlink <a> Ctrl+L",linkdescription:"enter link description here",linkdialog:'<p><b>Insert Hyperlink</b></p><p>http://example.com/ "optional title"</p>',quote:"Blockquote <blockquote> Ctrl+Q",quoteexample:"Blockquote",code:"Code Sample <pre><code> Ctrl+K",codeexample:"enter code here",image:"Image <img> Ctrl+G",imagedescription:"enter image description here",imagedialog:'<p><b>Insert Image</b></p><p>?i=diagram.jpg "optional title"</p>',olist:"Numbered List <ol> Ctrl+O",ulist:"Bulleted List <ul> Ctrl+U",litem:"List item",heading:"Heading <h1>/<h2> Ctrl+H",headingexample:"Heading",hr:"Horizontal Rule <hr> Ctrl+R",undo:"Undo - Ctrl+Z",redo:"Redo - Ctrl+Y",redomac:"Redo - Ctrl+Shift+Z",help:"Markdown Editing Help"};var f="?i=";var l="http://";Markdown.Editor=function(e,t,n){n=n||{};if(typeof n.handler==="function"){n={helpButton:n}}n.strings=n.strings||{};if(n.helpButton){n.strings.help=n.strings.help||n.helpButton.title}var i=function(e){return n.strings[e]||a[e]};t=t||"";var s=this.hooks=new Markdown.HookCollection;s.addNoop("onPreviewRefresh");s.addNoop("postBlockquoteCreation");s.addFalse("insertImageDialog");this.getConverter=function(){return e};var o=this,u;this.run=function(){if(u)return;u=new h(t);var a=new g(s,i);var f=new v(e,u,function(){s.onPreviewRefresh()});var l,c;if(!/\?noundo/.test(r.location.href)){l=new p(function(){f.refresh();if(c)c.setUndoRedoButtonStates()},u);this.textOperation=function(e){l.setCommandMode();e();o.refreshPreview()}}c=new m(t,u,l,f,a,n.helpButton,i);c.setUndoRedoButtonStates();var d=o.refreshPreview=function(){f.refresh(true)};d()}};c.prototype.findTags=function(t,n){var r=this;var i;if(t){i=e.extendRegExp(t,"","$");this.before=this.before.replace(i,function(e){r.startTag=r.startTag+e;return""});i=e.extendRegExp(t,"^","");this.selection=this.selection.replace(i,function(e){r.startTag=r.startTag+e;return""})}if(n){i=e.extendRegExp(n,"","$");this.selection=this.selection.replace(i,function(e){r.endTag=e+r.endTag;return""});i=e.extendRegExp(n,"^","");this.after=this.after.replace(i,function(e){r.endTag=e+r.endTag;return""})}};c.prototype.trimWhitespace=function(e){var t,n,r=this;if(e){t=n=""}else{t=function(e){r.before+=e;return""};n=function(e){r.after=e+r.after;return""}}this.selection=this.selection.replace(/^(\s*)/,t).replace(/(\s*)$/,n)};c.prototype.skipLines=function(e,t,n){if(e===undefined){e=1}if(t===undefined){t=1}e++;t++;var r;var s;if(navigator.userAgent.match(/Chrome/)){"X".match(/()./)}this.selection=this.selection.replace(/(^\n*)/,"");this.startTag=this.startTag+i.$1;this.selection=this.selection.replace(/(\n*$)/,"");this.endTag=this.endTag+i.$1;this.startTag=this.startTag.replace(/(^\n*)/,"");this.before=this.before+i.$1;this.endTag=this.endTag.replace(/(\n*$)/,"");this.after=this.after+i.$1;if(this.before){r=s="";while(e--){r+="\\n?";s+="\n"}if(n){r="\\n*"}this.before=this.before.replace(new i(r+"$",""),s)}if(this.after){r=s="";while(t--){r+="\\n?";s+="\n"}if(n){r="\\n*"}this.after=this.after.replace(new i(r,""),s)}};e.isVisible=function(e){if(window.getComputedStyle){return window.getComputedStyle(e,null).getPropertyValue("display")!=="none"}else if(e.currentStyle){return e.currentStyle["display"]!=="none"}};e.addEvent=function(e,t,n){if(e.attachEvent){e.attachEvent("on"+t,n)}else{e.addEventListener(t,n,false)}};e.removeEvent=function(e,t,n){if(e.detachEvent){e.detachEvent("on"+t,n)}else{e.removeEventListener(t,n,false)}};e.fixEolChars=function(e){e=e.replace(/\r\n/g,"\n");e=e.replace(/\r/g,"\n");return e};e.extendRegExp=function(e,t,n){if(t===null||t===undefined){t=""}if(n===null||n===undefined){n=""}var r=e.toString();var s;r=r.replace(/\/([gim]*)$/,function(e,t){s=t;return""});r=r.replace(/(^\/|\/$)/g,"");r=t+r+n;return new i(r,s)};t.getTop=function(e,t){var n=e.offsetTop;if(!t){while(e=e.offsetParent){n+=e.offsetTop}}return n};t.getHeight=function(e){return e.offsetHeight||e.scrollHeight};t.getWidth=function(e){return e.offsetWidth||e.scrollWidth};t.getPageSize=function(){var e,t;var n,i;if(self.innerHeight&&self.scrollMaxY){e=r.body.scrollWidth;t=self.innerHeight+self.scrollMaxY}else if(r.body.scrollHeight>r.body.offsetHeight){e=r.body.scrollWidth;t=r.body.scrollHeight}else{e=r.body.offsetWidth;t=r.body.offsetHeight}if(self.innerHeight){n=self.innerWidth;i=self.innerHeight}else if(r.documentElement&&r.documentElement.clientHeight){n=r.documentElement.clientWidth;i=r.documentElement.clientHeight}else if(r.body){n=r.body.clientWidth;i=r.body.clientHeight}var s=Math.max(e,n);var o=Math.max(t,i);return[s,o,n,i]};n.createBackground=function(){var e=r.createElement("div"),n=e.style;e.className="wmd-prompt-background";n.position="absolute";n.top="0";n.zIndex="1000";if(u.isIE){n.filter="alpha(opacity=50)"}else{n.opacity="0.5"}var i=t.getPageSize();n.height=i[1]+"px";if(u.isIE){n.left=r.documentElement.scrollLeft;n.width=r.documentElement.clientWidth}else{n.left="0";n.width="100%"}r.body.appendChild(e);return e};n.prompt=function(n,i,s){var o;var a;if(i===undefined){i=""}var f=function(e){var t=e.charCode||e.keyCode;if(t===27){l(true)}};var l=function(t){e.removeEvent(r.body,"keydown",f);var n=a.value;if(t){n=null}o.parentNode.removeChild(o);s(n);return false};var c=function(){o=r.createElement("div");o.className="wmd-prompt-dialog";o.style.padding="10px;";o.style.position="fixed";o.style.width="400px";o.style.zIndex="1001";var s=r.createElement("div");s.innerHTML=n;s.style.padding="5px";o.appendChild(s);var c=r.createElement("form"),h=c.style;c.onsubmit=function(){return l(false)};h.padding="0";h.margin="0";h.cssFloat="left";h.width="100%";h.textAlign="center";h.position="relative";o.appendChild(c);a=r.createElement("input");a.type="text";a.value=i;h=a.style;h.display="block";h.width="80%";h.marginLeft=h.marginRight="auto";c.appendChild(a);var p=r.createElement("input");p.type="button";p.onclick=function(){return l(false)};p.value="OK";h=p.style;h.margin="10px";h.display="inline";h.width="7em";var d=r.createElement("input");d.type="button";d.onclick=function(){return l(true)};d.value="Cancel";h=d.style;h.margin="10px";h.display="inline";h.width="7em";c.appendChild(p);c.appendChild(d);e.addEvent(r.body,"keydown",f);o.style.top="50%";o.style.left="50%";o.style.display="block";if(u.isIE_5or6){o.style.position="absolute";o.style.top=r.documentElement.scrollTop+200+"px";o.style.left="50%"}r.body.appendChild(o);o.style.marginTop=-(t.getHeight(o)/2)+"px";o.style.marginLeft=-(t.getWidth(o)/2)+"px"};setTimeout(function(){c();var e=i.length;if(a.selectionStart!==undefined){a.selectionStart=0;a.selectionEnd=e}else if(a.createTextRange){var t=a.createTextRange();t.collapse(false);t.moveStart("character",-e);t.moveEnd("character",e);t.select()}a.focus()},0)};var y=g.prototype;y.prefixes="(?:\\s{4,}|\\s*>|\\s*-\\s+|\\s*\\d+\\.|=|\\+|-|_|\\*|#|\\s*\\[[^\n]]+\\]:)";y.unwrap=function(e){var t=new i("([^\\n])\\n(?!(\\n|"+this.prefixes+"))","g");e.selection=e.selection.replace(t,"$1 $2")};y.wrap=function(e,t){this.unwrap(e);var n=new i("(.{1,"+t+"})( +|$\\n?)","gm"),r=this;e.selection=e.selection.replace(n,function(e,t){if((new i("^"+r.prefixes,"")).test(e)){return e}return t+"\n"});e.selection=e.selection.replace(/\s+$/,"")};y.doBold=function(e,t){return this.doBorI(e,t,2,this.getString("boldexample"))};y.doItalic=function(e,t){return this.doBorI(e,t,1,this.getString("italicexample"))};y.doBorI=function(e,t,n,r){e.trimWhitespace();e.selection=e.selection.replace(/\n{2,}/g,"\n");var s=/(\**$)/.exec(e.before)[0];var o=/(^\**)/.exec(e.after)[0];var u=Math.min(s.length,o.length);if(u>=n&&(u!=2||n!=1)){e.before=e.before.replace(i("[*]{"+n+"}$",""),"");e.after=e.after.replace(i("^[*]{"+n+"}",""),"")}else if(!e.selection&&o){e.after=e.after.replace(/^([*_]*)/,"");e.before=e.before.replace(/(\s?)$/,"");var a=i.$1;e.before=e.before+o+a}else{if(!e.selection&&!o){e.selection=r}var f=n<=1?"*":"**";e.before=e.before+f;e.after=f+e.after}return};y.stripLinkDefs=function(e,t){e=e.replace(/^[ ]{0,3}\[(\d+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?[ \t]*\n?[ \t]*(?:(\n*)["(](.+?)[")][ \t]*)?(?:\n+|$)/gm,function(e,n,r,i,s){t[n]=e.replace(/\s*$/,"");if(i){t[n]=e.replace(/["(](.+?)[")]$/,"");return i+s}return""});return e};y.addLinkDef=function(e,t){var n=0;var r={};e.before=this.stripLinkDefs(e.before,r);e.selection=this.stripLinkDefs(e.selection,r);e.after=this.stripLinkDefs(e.after,r);var i="";var s=/(\[)((?:\[[^\]]*\]|[^\[\]])*)(\][ ]?(?:\n[ ]*)?\[)(\d+)(\])/g;var o=function(e){n++;e=e.replace(/^[ ]{0,3}\[(\d+)\]:/,"  ["+n+"]:");i+="\n"+e};var u=function(e,t,i,a,f,l){i=i.replace(s,u);if(r[f]){o(r[f]);return t+i+a+n+l}return e};e.before=e.before.replace(s,u);if(t){o(t)}else{e.selection=e.selection.replace(s,u)}var a=n;e.after=e.after.replace(s,u);if(e.after){e.after=e.after.replace(/\n*$/,"")}if(!e.after){e.selection=e.selection.replace(/\n*$/,"")}e.after+="\n\n"+i;return a};y.doLinkOrImage=function(e,t,r){e.trimWhitespace();e.findTags(/\s*!?\[/,/\][ ]?(?:\n[ ]*)?(\[.*?\])?/);var i;if(e.endTag.length>1&&e.startTag.length>0){e.startTag=e.startTag.replace(/!?\[/,"");e.endTag="";this.addLinkDef(e,null)}else{e.selection=e.startTag+e.selection+e.endTag;e.startTag=e.endTag="";if(/\n\n/.test(e.selection)){this.addLinkDef(e,null);return}var s=this;var o=function(n){i.parentNode.removeChild(i);if(n!==null){e.selection=(" "+e.selection).replace(/([^\\](?:\\\\)*)(?=[[\]])/g,"$1\\").substr(1);var o=" [999]: "+b(n);var u=s.addLinkDef(e,o);e.startTag=r?"![":"[";e.endTag="]["+u+"]";if(!e.selection){if(r){e.selection=s.getString("imagedescription")}else{e.selection=s.getString("linkdescription")}}}t()};i=n.createBackground();if(r){if(!this.hooks.insertImageDialog(o))n.prompt(this.getString("imagedialog"),f,o)}else{n.prompt(this.getString("linkdialog"),l,o)}return true}};y.doAutoindent=function(e,t){var n=this,r=false;e.before=e.before.replace(/(\n|^)[ ]{0,3}([*+-]|\d+[.])[ \t]*\n$/,"\n\n");e.before=e.before.replace(/(\n|^)[ ]{0,3}>[ \t]*\n$/,"\n\n");e.before=e.before.replace(/(\n|^)[ \t]+\n$/,"\n\n");if(!e.selection&&!/^[ \t]*(?:\n|$)/.test(e.after)){e.after=e.after.replace(/^[^\n]*/,function(t){e.selection=t;return""});r=true}if(/(\n|^)[ ]{0,3}([*+-]|\d+[.])[ \t]+.*\n$/.test(e.before)){if(n.doList){n.doList(e)}}if(/(\n|^)[ ]{0,3}>[ \t]+.*\n$/.test(e.before)){if(n.doBlockquote){n.doBlockquote(e)}}if(/(\n|^)(\t|[ ]{4,}).*\n$/.test(e.before)){if(n.doCode){n.doCode(e)}}if(r){e.after=e.selection+e.after;e.selection=""}};y.doBlockquote=function(e,t){e.selection=e.selection.replace(/^(\n*)([^\r]+?)(\n*)$/,function(t,n,r,i){e.before+=n;e.after=i+e.after;return r});e.before=e.before.replace(/(>[ \t]*)$/,function(t,n){e.selection=n+e.selection;return""});e.selection=e.selection.replace(/^(\s|>)+$/,"");e.selection=e.selection||this.getString("quoteexample");var n="",r="",i;if(e.before){var s=e.before.replace(/\n$/,"").split("\n");var u=false;for(var a=0;a<s.length;a++){var f=false;i=s[a];u=u&&i.length>0;if(/^>/.test(i)){f=true;if(!u&&i.length>1)u=true}else if(/^[ \t]*$/.test(i)){f=true}else{f=u}if(f){n+=i+"\n"}else{r+=n+i;n="\n"}}if(!/(^|\n)>/.test(n)){r+=n;n=""}}e.startTag=n;e.before=r;if(e.after){e.after=e.after.replace(/^\n?/,"\n")}e.after=e.after.replace(/^(((\n|^)(\n[ \t]*)*>(.+\n)*.*)+(\n[ \t]*)*)/,function(t){e.endTag=t;return""});var l=function(t){var n=t?"> ":"";if(e.startTag){e.startTag=e.startTag.replace(/\n((>|\s)*)\n$/,function(e,t){return"\n"+t.replace(/^[ ]{0,3}>?[ \t]*$/gm,n)+"\n"})}if(e.endTag){e.endTag=e.endTag.replace(/^\n((>|\s)*)\n/,function(e,t){return"\n"+t.replace(/^[ ]{0,3}>?[ \t]*$/gm,n)+"\n"})}};if(/^(?![ ]{0,3}>)/m.test(e.selection)){this.wrap(e,o.lineLength-2);e.selection=e.selection.replace(/^/gm,"> ");l(true);e.skipLines()}else{e.selection=e.selection.replace(/^[ ]{0,3}> ?/gm,"");this.unwrap(e);l(false);if(!/^(\n|^)[ ]{0,3}>/.test(e.selection)&&e.startTag){e.startTag=e.startTag.replace(/\n{0,2}$/,"\n\n")}if(!/(\n|^)[ ]{0,3}>.*$/.test(e.selection)&&e.endTag){e.endTag=e.endTag.replace(/^\n{0,2}/,"\n\n")}}e.selection=this.hooks.postBlockquoteCreation(e.selection);if(!/\n/.test(e.selection)){e.selection=e.selection.replace(/^(> *)/,function(t,n){e.startTag+=n;return""})}};y.doCode=function(e,t){var n=/\S[ ]*$/.test(e.before);var r=/^[ ]*\S/.test(e.after);if(!r&&!n||/\n/.test(e.selection)){e.before=e.before.replace(/[ ]{4}$/,function(t){e.selection=t+e.selection;return""});var i=1;var s=1;if(/(\n|^)(\t|[ ]{4,}).*\n$/.test(e.before)){i=0}if(/^\n(\t|[ ]{4,})/.test(e.after)){s=0}e.skipLines(i,s);if(!e.selection){e.startTag="    ";e.selection=this.getString("codeexample")}else{if(/^[ ]{0,3}\S/m.test(e.selection)){if(/\n/.test(e.selection))e.selection=e.selection.replace(/^/gm,"    ");else e.before+="    "}else{e.selection=e.selection.replace(/^(?:[ ]{4}|[ ]{0,3}\t)/gm,"")}}}else{e.trimWhitespace();e.findTags(/`/,/`/);if(!e.startTag&&!e.endTag){e.startTag=e.endTag="`";if(!e.selection){e.selection=this.getString("codeexample")}}else if(e.endTag&&!e.startTag){e.before+=e.endTag;e.endTag=""}else{e.startTag=e.endTag=""}}};y.doList=function(e,t,n){var r=/(\n|^)(([ ]{0,3}([*+-]|\d+[.])[ \t]+.*)(\n.+|\n{2,}([*+-].*|\d+[.])[ \t]+.*|\n{2,}[ \t]+\S.*)*)\n*$/;var s=/^\n*(([ ]{0,3}([*+-]|\d+[.])[ \t]+.*)(\n.+|\n{2,}([*+-].*|\d+[.])[ \t]+.*|\n{2,}[ \t]+\S.*)*)\n*/;var u="-";var a=1;var f=function(){var e;if(n){e=" "+a+". ";a++}else{e=" "+u+" "}return e};var l=function(e){if(n===undefined){n=/^\s*\d/.test(e)}e=e.replace(/^[ ]{0,3}([*+-]|\d+[.])\s/gm,function(e){return f()});return e};e.findTags(/(\n|^)*[ ]{0,3}([*+-]|\d+[.])\s+/,null);if(e.before&&!/\n$/.test(e.before)&&!/^\n/.test(e.startTag)){e.before+=e.startTag;e.startTag=""}if(e.startTag){var c=/\d+[.]/.test(e.startTag);e.startTag="";e.selection=e.selection.replace(/\n[ ]{4}/g,"\n");this.unwrap(e);e.skipLines();if(c){e.after=e.after.replace(s,l)}if(n==c){return}}var h=1;e.before=e.before.replace(r,function(e){if(/^\s*([*+-])/.test(e)){u=i.$1}h=/[^\n]\n\n[^\n]/.test(e)?1:0;return l(e)});if(!e.selection){e.selection=this.getString("litem")}var p=f();var d=1;e.after=e.after.replace(s,function(e){d=/[^\n]\n\n[^\n]/.test(e)?1:0;return l(e)});e.trimWhitespace(true);e.skipLines(h,d,true);e.startTag=p;var v=p.replace(/./g," ");this.wrap(e,o.lineLength-v.length);e.selection=e.selection.replace(/\n/g,"\n"+v)};y.doHeading=function(e,t){e.selection=e.selection.replace(/\s+/g," ");e.selection=e.selection.replace(/(^\s+|\s+$)/g,"");if(!e.selection){e.startTag="## ";e.selection=this.getString("headingexample");e.endTag=" ##";return}var n=0;e.findTags(/#+[ ]*/,/[ ]*#+/);if(/#+/.test(e.startTag)){n=i.lastMatch.length}e.startTag=e.endTag="";e.findTags(null,/\s?(-+|=+)/);if(/=+/.test(e.endTag)){n=1}if(/-+/.test(e.endTag)){n=2}e.startTag=e.endTag="";e.skipLines(1,1);var r=n==0?2:n-1;if(r>0){var s=r>=2?"-":"=";var u=e.selection.length;if(u>o.lineLength){u=o.lineLength}e.endTag="\n";while(u--){e.endTag+=s}}};y.doHorizontalRule=function(e,t){e.startTag="----------\n";e.selection="";e.skipLines(2,1,true)}})()
